h1. TAO on Debian, Ubuntu with Apache2 & mySQL

{{>toc}}

This installation guide focuses on installing the TAO platform on Ubuntu using Apache2, PHP & mySQL.

h2. 1. Apache2, PHP & mySQL Installation

h3. 1.1. Apache2 Installation

The first step of the installation of our environment is to install the Apache2 web server. To do so, open up a terminal and type the following command lines. The _apt-get update_ command aims at updating your system. You can skip this command if you think your system is up to date.

<pre>
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install apache2
</pre>

h3. 1.2. PHP Installation

To Install PHP and modules needed by the TAO platform to run, open up a terminal and enter the following commands.

<pre>
sudo apt-get install php5
sudo apt-get install php5-gd php5-mysql php5-tidy php5-curl php-xml-parser
</pre>

PHP and its modules required by TAO are now installed on the computer.

h3. 1.3. mySQL Installation

The last component to install is mySQL server.

<pre>
sudo apt-get install mysql-server
</pre>


mySQL serveer will install and you're prompt to put a _root_ password.

h2. 2. Apache2, PHP & mySQL Setup

h3. 2.1. Apache2 Setup

h4. 2.1.1. Service Configuration

We just have to check if Apache2 is correctly running. Simply open up your web browser and access _http://localhost_. An Apache2 test page containing "It Works!" should be displayed in your web browser.

h4. 2.1.2. Virtual Host

The TAO platform requires to be run with an _Apache Virtual Host_. We will create such a virtual host in the Apache2 configuration file. Edit the file located at _/etc/apache2/sites-available/taoplatform.conf_ with your favourite editor. We will use _nano_.

<pre>
sudo nano /etc/apache2/sites-available/taoplatform.conf
</pre>

Now, we create a virtual host named _taoplatform_. Its _DocumentRoot_ is _/var/www/taoplatform_. This is where the TAO source code will be actually deployed. We will create this directory later at deployment-time. Feel free to change its name according to your needs. Insert the following lines at the end of the file we are currently editing.

<pre>
NameVirtualHost 127.0.0.1:80
ServerName localhost

<VirtualHost 127.0.0.1:80>
    ServerAdmin webmaster@taoplatform
    ServerName taoplatform

    DocumentRoot /var/www/taoplatform

    <Directory /var/www/taoplatform>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
</pre>

You can save the file now. Some explanations about this Virtual Host configuration:

* *NameVirtualHost* with the NameVirtualHost directive you specify the IP address on which the server will receive requests for the name-based virtual hosts. This will usually be the address to which your name-based virtual host names resolve.
* *ServerAdmin* sets the e-mail address that the server includes in any error messages it returns to the client.
* *ServerName* sets hostname and port that the server uses to identify itself. Here we affect the hostname _taoplatform_ but it could be _www.tao-platform.com_ or _www.tao-platform.com:80_.
* *DocumentRoot* is the root directory where we place the PHP source code that concerns the TAO Platform. We will create later in this tutorial the _/var/www/taoplatform_ directory.

Then you need to activate the site and reload the apache2 configuration
<pre>
sudo a2ensite taoplatform
sudo service apache2 reload
</pre>

More information about Apache directives and virtual hosting:
* "Apache directives":http://httpd.apache.org/docs/2.4/mod/core.html
* "Apache virtual hosting":http://httpd.apache.org/docs/2.4/vhosts/

h4. 2.1.3. Rewrite Module

The TAO Platform requires the Apache2 module _rewrite_module_ to be installed to run perfectly. The Rewrite Module of Apache is most of the time enabled at installation time in major Linux distributions. To check if _rewrite_module_ is present and running, type the following command in your terminal.

<pre>
sudo apachectl -t -D DUMP_MODULES
</pre>

You should see the list of running modules and the _rewrite_module (shared)_ entry. If you find it, you can skip this and go to the next section of this guide. If you do not see it, you will have to install it. 

To install the Apache2 module _rewrite_module_ just type following command line

<pre>
sudo a2enmod rewrite
</pre>

and restart your web server to make the modification effective.

<pre>
sudo service apache2 restart
</pre>

h4. 2.1.4. Folders, Rights and Host Resolution

We now have to create the _taoplatform_ folder in /var/www. To do so, type the following commands.

<pre>
cd /var/www
sudo mkdir taoplatform
</pre>

By default, Apache2 runs as the _www-data_ user that belongs to the _www-data_ group. We then bind the _taoplatform_ directory to the _www-data_ group.

<pre>
sudo chgrp www-data taoplatform
</pre>

We will deal with read-write-execute permissions later on. Finally, we add an entry in the _hosts_ file of the Operating System to make Apache2 able to resolve _taoplatform_.

<pre>
sudo nano /etc/hosts
</pre>

Append the following line in the file:

<pre>
127.0.0.1   taoplatform
</pre>

Finally, we restart Apache to take this new configuration into account.

<pre>
sudo service apache2 restart
</pre>

h3. 2.2. PHP Setup

The PHP Setup is quick and simple. Open the PHP configuration file located at _/etc/php5/apache2/php.ini_.

<pre>
sudo nano /etc/php5/apache2/php.ini
</pre>

Make sure that the following configuration options are correct.

<pre>
magic_quotes_gpc = Off (not needed in PHP 5.4)
short_open_tag = On
register_globals = Off (not needed in PHP 5.4)
</pre>

In most versions of PHP, they are correctly set. However, if you have to make any change, save the file and restart your Apache2 web server to make this new configuration taken into account.

<pre>
sudo service apache2 restart
</pre>

h3. 2.3. mySQL Setup

The following setup operation is optional. If you want to make a secure installation of mySQL by changing its _root_ password, enter the following command in your terminal. 

<pre>
mysql_secure_installation
</pre>

The _mysql_secure_installation_ program will simply ask you for a new _root_ password.

*Important!* If you plan to access MySQL using a specific database user (not root), make sure it has the following privileges:
EXECUTE, SELECT, SHOW DATABASES, ALTER, ALTER ROUTINE, CREATE, CREATE ROUTINE, DELETE, DROP, INDEX, INSERT, UPDATE, RELOAD

If you need more information about database privileges and databases, please visit the [[DatabaseUserPrivileges|page dedicated to this topic]].

h2. 3. TAO Platform Deployment

h3. 3.1. Download the Latest Version of TAO

We will now download the latest version of the TAO source code and deploy it on the web server. Go to the official TAO download page and download the last "Stable Release":http://tao-assessment.com/resources/download-tao.

<pre>
wget http://releases.taotesting.com/TAO_2.6.5_build.zip
</pre>

Suppose we saved the TAO source code zip archive in _/home/myuser/TAO_2.1.01_build.zip_. Run the following command lines to extract the content of the archive in the dedicated directory _/var/www/taoplatform_ we created previously in this guide.

<pre>
cd /home/myuser
sudo unzip TAO_2.6.5_build.zip -d /var/www/taoplatform
</pre>

If you list the content of _/var/www/taoplatform_, you should see the following file & directory structure:

* _/var/www/taoplatform/crossdomain.xml_
* _/var/www/taoplatform/favicon.ico_
* _/var/www/taoplatform/fdl-1.3.txt_
* _/var/www/taoplatform/filemanager_
* _/var/www/taoplatform/generis_
* _/var/www/taoplatform/gpl-2.0.txt_
* _/var/www/taoplatform/index.php_
* _/var/www/taoplatform/tao_
* _/var/www/taoplatform/taoDelivery_
* _/var/www/taoplatform/taoGroups_
* _/var/www/taoplatform/taoItems_
* _/var/www/taoplatform/taoResults_
* _/var/www/taoplatform/taoSubjects_
* _/var/www/taoplatform/taoTests_
* _/var/www/taoplatform/wfEngine_

h3. 3.2. File System Permissions

We now have to make sure that file system permission in the _/var/www/taoplatform_ directory makes Apache able to read, write, and execute correctly files belonging to the TAO platform. All files must be accessible by the _www-data_ user & group.

<pre>
cd /var/www
sudo chown -R www-data taoplatform
sudo chgrp -R www-data taoplatform
sudo chmod -R 775 taoplatform
</pre>

h3. 3.3. TAO Installation Wizard

For this last step of the installation process, open up your favourite web browser at http://taoplatform/tao/install. The installation wizard appears. 

Check if all the System Configuration entries are "green". If it is not the case, please check that each step of this guide are done. If you still experience issues, feel free to contact us on the forum.

Finally, follow the instructions to finalize your TAO Platform installation.